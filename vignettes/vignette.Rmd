---
title: "genemodel Tutorial"
author: "J Grey Monroe"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r, echo=F}
library(genemodel)
```

This package provides a simple way to make positionally accurate plots of gene models similar to those found on The Arabidopsis Information Resource (TAIR). These plots are suitable for presentations and publications where showing gene models is appropriate to comunicate genetic research.  

### Installation

To install the package:
```{r, eval=F}
install_bitbucket("greymonroe/genemodel")
library(genemodel)
```

### Example  
Now lets look at an example gene that we are going to model. This is gene is `AT5G62640`. The original gene model information can be found here http://www.arabidopsis.org/servlets/TairObject?type=gene&id=1000654517. It is stored in the `Gene Feature` table on that page. 
<img src="/Users/greymonroe/Desktop/AT5G62640_TAIR_Features.png" height="300px" width="300px" />  
...  
  
  
Once this table is extracted and saved as .csv or .txt table file, it can be loaded into R as a data.frame object. The package *genemodel* has this data already stored and can be loaded like this:

```{r, eval=T}
data("AT5G62640")
```

When we look at the strucutre of this data.frame,
```{r, eval=T}
head(AT5G62640, 15)
```
we see that it is a two column data.frame with the first column being the name of the feature type and the second specifying the coordinate position within the gene model that the feature occupies. 

The feature types that TAIR provides in the `Gene Feature` table for gene models are:
* ORF - the Open Reading Frame which extends from the first to last exon
* Coding Region - segments of the gene that code RNA  
* 5` UTR - Untranlated Region.  
* Exon   
* Intron  
* 3` UTR  

### genemodel.plot function

Before we can plot the gene, we need to extract some other information from the TAIR gene model description. First we need the start and stop base pair positions for the gene. These can be found in the `Map Locations` section of the TAIR gene model page and correspond to the `Coordinates` of  `Map Type`  'nuc_sequence.' Next weed the direction of transcription which can also be found in the `Map Locations` section under `Orientation`. Again we want the value for corresponding the `Map Type` that equals 'nuc_sequence' See image below from TAIR.
<img src="/Users/greymonroe/Desktop/AT5G62640_TAIR_Map_Locations.png" height="50px" width="700px" />  


We now have the information necessary to plot the gene with `genemodel.plot`
```{r, fig.width=7.5, fig.height=2}
par(mar=c(.1,1,.1,1), cex=1)
genemodel.plot(model=AT5G62640, start=25149433, bpstop=25152541, orientation="reverse", xaxis=T)
```

`genemodel.plot` automatically recongizes the types of gene features and plots them in accurate positions and orientation. `genemodel.plot` uses the same color scheme as TAIR to color the gene features. UTRs are colored light blue, exons are colored dark blue and introns are indicated by the bent line. The direction of transcripton is also marked in way consitent with TAIR notation by the pointed end of the gene model. By only plotting UTRs, exons and introns, `genemodel.plot` ignores the 'ORF' and "coding region' feature types as they are redundant. 

### mutation.plot function

The next function we will look at is the `mutation.plot` function which plots mutations at correct positions on an already plotted gene model. 

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
